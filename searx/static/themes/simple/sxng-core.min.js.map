{"version":3,"mappings":"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","names":["endpoint: EndpointsKeys","settings: Settings"],"ignoreList":[],"sources":["../../../../client/simple/src/js/Plugin.ts","../../../../client/simple/src/js/toolkit.ts","../../../../client/simple/src/js/loader.ts","../../../../client/simple/src/js/router.ts"],"sourcesContent":["// SPDX-License-Identifier: AGPL-3.0-or-later\r\n\r\n/**\r\n * Base class for client-side plugins.\r\n *\r\n * @remarks\r\n * Handle conditional loading of the plugin in:\r\n *\r\n *   - client/simple/src/js/router.ts\r\n *\r\n * @abstract\r\n */\r\nexport abstract class Plugin {\r\n  /**\r\n   * Plugin name.\r\n   */\r\n  protected readonly id: string;\r\n\r\n  /**\r\n   * @remarks\r\n   * Don't hold references of this instance outside the class.\r\n   */\r\n  protected constructor(id: string) {\r\n    this.id = id;\r\n\r\n    void this.invoke();\r\n  }\r\n\r\n  private async invoke(): Promise<void> {\r\n    try {\r\n      console.debug(`[PLUGIN] ${this.id}: Running...`);\r\n      const result = await this.run();\r\n      if (!result) return;\r\n\r\n      console.debug(`[PLUGIN] ${this.id}: Running post-exec...`);\r\n      // @ts-expect-error\r\n      void (await this.post(result as NonNullable<Awaited<ReturnType<this[\"run\"]>>>));\r\n    } catch (error) {\r\n      console.error(`[PLUGIN] ${this.id}:`, error);\r\n    } finally {\r\n      console.debug(`[PLUGIN] ${this.id}: Done.`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Plugin goes here.\r\n   *\r\n   * @remarks\r\n   * The plugin is already loaded at this point. If you wish to execute\r\n   * conditions to exit early, consider moving the logic to:\r\n   *\r\n   *   - client/simple/src/js/router.ts\r\n   *\r\n   * ...to avoid unnecessarily loading this plugin on the client.\r\n   */\r\n  protected abstract run(): Promise<unknown>;\r\n\r\n  /**\r\n   * Post-execution hook.\r\n   *\r\n   * @remarks\r\n   * The hook is only executed if `#run()` returns a truthy value.\r\n   */\r\n  // @ts-expect-error\r\n  protected abstract post(result: NonNullable<Awaited<ReturnType<this[\"run\"]>>>): Promise<void>;\r\n}\r\n","// SPDX-License-Identifier: AGPL-3.0-or-later\r\n\r\nimport type { KeyBindingLayout } from \"./main/keyboard.ts\";\r\n\r\n// synced with searx/webapp.py get_client_settings\r\ntype Settings = {\r\n  plugins?: string[];\r\n  advanced_search?: boolean;\r\n  autocomplete?: string;\r\n  autocomplete_min?: number;\r\n  doi_resolver?: string;\r\n  favicon_resolver?: string;\r\n  hotkeys?: KeyBindingLayout;\r\n  method?: \"GET\" | \"POST\";\r\n  query_in_title?: boolean;\r\n  results_on_new_tab?: boolean;\r\n  safesearch?: 0 | 1 | 2;\r\n  search_on_category_select?: boolean;\r\n  theme?: string;\r\n  theme_static_path?: string;\r\n  translations?: Record<string, string>;\r\n  url_formatting?: \"pretty\" | \"full\" | \"host\";\r\n};\r\n\r\ntype HTTPOptions = {\r\n  body?: BodyInit;\r\n  timeout?: number;\r\n};\r\n\r\ntype ReadyOptions = {\r\n  // all values must be truthy for the callback to be executed\r\n  on?: (boolean | undefined)[];\r\n};\r\n\r\nexport type EndpointsKeys = keyof typeof Endpoints;\r\n\r\nexport const Endpoints = {\r\n  index: \"index\",\r\n  results: \"results\",\r\n  preferences: \"preferences\",\r\n  unknown: \"unknown\"\r\n} as const;\r\n\r\nexport const mutable = {\r\n  closeDetail: undefined as (() => void) | undefined,\r\n  scrollPageToSelected: undefined as (() => void) | undefined,\r\n  selectImage: undefined as ((resultElement: HTMLElement) => void) | undefined,\r\n  selectNext: undefined as ((openDetailView?: boolean) => void) | undefined,\r\n  selectPrevious: undefined as ((openDetailView?: boolean) => void) | undefined\r\n};\r\n\r\nconst getEndpoint = (): EndpointsKeys => {\r\n  const metaEndpoint = document.querySelector('meta[name=\"endpoint\"]')?.getAttribute(\"content\");\r\n\r\n  if (metaEndpoint && metaEndpoint in Endpoints) {\r\n    return metaEndpoint as EndpointsKeys;\r\n  }\r\n\r\n  return Endpoints.unknown;\r\n};\r\n\r\nconst getSettings = (): Settings => {\r\n  const settings = document.querySelector(\"script[client_settings]\")?.getAttribute(\"client_settings\");\r\n  if (!settings) return {};\r\n\r\n  try {\r\n    return JSON.parse(atob(settings));\r\n  } catch (error) {\r\n    console.error(\"Failed to load client_settings:\", error);\r\n    return {};\r\n  }\r\n};\r\n\r\nexport const http = async (method: string, url: string | URL, options?: HTTPOptions): Promise<Response> => {\r\n  const controller = new AbortController();\r\n  const timeoutId = setTimeout(() => controller.abort(), options?.timeout ?? 30_000);\r\n\r\n  const res = await fetch(url, {\r\n    body: options?.body,\r\n    method: method,\r\n    signal: controller.signal\r\n  }).finally(() => clearTimeout(timeoutId));\r\n  if (!res.ok) {\r\n    throw new Error(res.statusText);\r\n  }\r\n\r\n  return res;\r\n};\r\n\r\nexport const listen = <K extends keyof DocumentEventMap, E extends HTMLElement>(\r\n  type: string | K,\r\n  target: string | Document | E,\r\n  listener: (this: E, event: DocumentEventMap[K]) => void | Promise<void>,\r\n  options?: AddEventListenerOptions\r\n): void => {\r\n  if (typeof target !== \"string\") {\r\n    target.addEventListener(type, listener as EventListener, options);\r\n    return;\r\n  }\r\n\r\n  document.addEventListener(\r\n    type,\r\n    (event: Event) => {\r\n      for (const node of event.composedPath()) {\r\n        if (node instanceof HTMLElement && node.matches(target)) {\r\n          try {\r\n            listener.call(node as E, event as DocumentEventMap[K]);\r\n          } catch (error) {\r\n            console.error(error);\r\n          }\r\n          break;\r\n        }\r\n      }\r\n    },\r\n    options\r\n  );\r\n};\r\n\r\nexport const ready = (callback: () => void, options?: ReadyOptions): void => {\r\n  for (const condition of options?.on ?? []) {\r\n    if (!condition) {\r\n      return;\r\n    }\r\n  }\r\n\r\n  if (document.readyState !== \"loading\") {\r\n    callback();\r\n  } else {\r\n    listen(\"DOMContentLoaded\", document, callback, { once: true });\r\n  }\r\n};\r\n\r\nexport const endpoint: EndpointsKeys = getEndpoint();\r\nexport const settings: Settings = getSettings();\r\n","// SPDX-License-Identifier: AGPL-3.0-or-later\r\n\r\nimport type { Plugin } from \"./Plugin.ts\";\r\nimport { type EndpointsKeys, endpoint } from \"./toolkit.ts\";\r\n\r\ntype Options =\r\n  | {\r\n      on: \"global\";\r\n    }\r\n  | {\r\n      on: \"endpoint\";\r\n      where: EndpointsKeys[];\r\n    };\r\n\r\nexport const load = <T extends Plugin>(instance: () => Promise<T>, options: Options): void => {\r\n  if (!check(options)) return;\r\n\r\n  void instance();\r\n};\r\n\r\nconst check = (options: Options): boolean => {\r\n  // biome-ignore lint/style/useDefaultSwitchClause: options is typed\r\n  switch (options.on) {\r\n    case \"global\": {\r\n      return true;\r\n    }\r\n    case \"endpoint\": {\r\n      if (!options.where.includes(endpoint)) {\r\n        // not on the expected endpoint\r\n        return false;\r\n      }\r\n\r\n      return true;\r\n    }\r\n  }\r\n};\r\n","// SPDX-License-Identifier: AGPL-3.0-or-later\r\n\r\nimport { load } from \"./loader.ts\";\r\nimport { Endpoints, endpoint, listen, ready, settings } from \"./toolkit.ts\";\r\n\r\nready(() => {\r\n  document.documentElement.classList.remove(\"no-js\");\r\n  document.documentElement.classList.add(\"js\");\r\n\r\n  listen(\"click\", \".close\", function (this: HTMLElement) {\r\n    (this.parentNode as HTMLElement)?.classList.add(\"invisible\");\r\n  });\r\n\r\n  listen(\"click\", \".searxng_init_map\", async function (this: HTMLElement, event: Event) {\r\n    event.preventDefault();\r\n    this.classList.remove(\"searxng_init_map\");\r\n\r\n    load(() => import(\"./plugin/MapView.ts\").then(({ default: Plugin }) => new Plugin(this)), {\r\n      on: \"endpoint\",\r\n      where: [Endpoints.results]\r\n    });\r\n  });\r\n\r\n  if (settings.plugins?.includes(\"infiniteScroll\")) {\r\n    load(() => import(\"./plugin/InfiniteScroll.ts\").then(({ default: Plugin }) => new Plugin()), {\r\n      on: \"endpoint\",\r\n      where: [Endpoints.results]\r\n    });\r\n  }\r\n\r\n  if (settings.plugins?.includes(\"calculator\")) {\r\n    load(() => import(\"./plugin/Calculator.ts\").then(({ default: Plugin }) => new Plugin()), {\r\n      on: \"endpoint\",\r\n      where: [Endpoints.results]\r\n    });\r\n  }\r\n});\r\n\r\nready(\r\n  () => {\r\n    void import(\"./main/keyboard.ts\");\r\n    void import(\"./main/search.ts\");\r\n\r\n    if (settings.autocomplete) {\r\n      void import(\"./main/autocomplete.ts\");\r\n    }\r\n  },\r\n  { on: [endpoint === Endpoints.index] }\r\n);\r\n\r\nready(\r\n  () => {\r\n    void import(\"./main/keyboard.ts\");\r\n    void import(\"./main/results.ts\");\r\n    void import(\"./main/search.ts\");\r\n\r\n    if (settings.autocomplete) {\r\n      void import(\"./main/autocomplete.ts\");\r\n    }\r\n  },\r\n  { on: [endpoint === Endpoints.results] }\r\n);\r\n\r\nready(\r\n  () => {\r\n    void import(\"./main/preferences.ts\");\r\n  },\r\n  { on: [endpoint === Endpoints.preferences] }\r\n);\r\n"],"file":"sxng-core.min.js"}