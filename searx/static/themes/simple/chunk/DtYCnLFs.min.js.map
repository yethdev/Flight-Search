{"version":3,"file":"DtYCnLFs.min.js","names":["baseKeyBinding: Record<string, KeyBinding>","keyBindingLayouts: Record<KeyBindingLayout, Record<string, KeyBinding>>","keyBindings: Record<string, KeyBinding>","next: HTMLElement | undefined","categories: Record<string, KeyBinding[]>"],"sources":["../../../../../client/simple/src/js/main/keyboard.ts"],"sourcesContent":["// SPDX-License-Identifier: AGPL-3.0-or-later\r\n\r\nimport { listen, mutable, settings } from \"../toolkit.ts\";\r\nimport { assertElement } from \"../util/assertElement.ts\";\r\n\r\nexport type KeyBindingLayout = \"default\" | \"vim\";\r\n\r\ntype KeyBinding = {\r\n  key: string;\r\n  fun: (event: KeyboardEvent) => void;\r\n  des: string;\r\n  cat: string;\r\n};\r\n\r\ntype HighlightResultElement = \"down\" | \"up\" | \"visible\" | \"bottom\" | \"top\";\r\n\r\n/* common base for layouts */\r\nconst baseKeyBinding: Record<string, KeyBinding> = {\r\n  Escape: {\r\n    key: \"ESC\",\r\n    fun: (event: KeyboardEvent) => removeFocus(event),\r\n    des: \"remove focus from the focused input\",\r\n    cat: \"Control\"\r\n  },\r\n  c: {\r\n    key: \"c\",\r\n    fun: () => copyURLToClipboard(),\r\n    des: \"copy url of the selected result to the clipboard\",\r\n    cat: \"Results\"\r\n  },\r\n  h: {\r\n    key: \"h\",\r\n    fun: () => toggleHelp(keyBindings),\r\n    des: \"toggle help window\",\r\n    cat: \"Other\"\r\n  },\r\n  i: {\r\n    key: \"i\",\r\n    fun: () => searchInputFocus(),\r\n    des: \"focus on the search input\",\r\n    cat: \"Control\"\r\n  },\r\n  n: {\r\n    key: \"n\",\r\n    fun: () => GoToNextPage(),\r\n    des: \"go to next page\",\r\n    cat: \"Results\"\r\n  },\r\n  o: {\r\n    key: \"o\",\r\n    fun: () => openResult(false),\r\n    des: \"open search result\",\r\n    cat: \"Results\"\r\n  },\r\n  p: {\r\n    key: \"p\",\r\n    fun: () => GoToPreviousPage(),\r\n    des: \"go to previous page\",\r\n    cat: \"Results\"\r\n  },\r\n  r: {\r\n    key: \"r\",\r\n    fun: () => reloadPage(),\r\n    des: \"reload page from the server\",\r\n    cat: \"Control\"\r\n  },\r\n  t: {\r\n    key: \"t\",\r\n    fun: () => openResult(true),\r\n    des: \"open the result in a new tab\",\r\n    cat: \"Results\"\r\n  }\r\n};\r\n\r\nconst keyBindingLayouts: Record<KeyBindingLayout, Record<string, KeyBinding>> = {\r\n  // SearXNG layout\r\n  default: {\r\n    ArrowLeft: {\r\n      key: \"←\",\r\n      fun: () => highlightResult(\"up\")(),\r\n      des: \"select previous search result\",\r\n      cat: \"Results\"\r\n    },\r\n    ArrowRight: {\r\n      key: \"→\",\r\n      fun: () => highlightResult(\"down\")(),\r\n      des: \"select next search result\",\r\n      cat: \"Results\"\r\n    },\r\n    ...baseKeyBinding\r\n  },\r\n\r\n  // Vim-like keyboard layout\r\n  vim: {\r\n    b: {\r\n      key: \"b\",\r\n      fun: () => scrollPage(-window.innerHeight),\r\n      des: \"scroll one page up\",\r\n      cat: \"Navigation\"\r\n    },\r\n    d: {\r\n      key: \"d\",\r\n      fun: () => scrollPage(window.innerHeight / 2),\r\n      des: \"scroll half a page down\",\r\n      cat: \"Navigation\"\r\n    },\r\n    f: {\r\n      key: \"f\",\r\n      fun: () => scrollPage(window.innerHeight),\r\n      des: \"scroll one page down\",\r\n      cat: \"Navigation\"\r\n    },\r\n    g: {\r\n      key: \"g\",\r\n      fun: () => scrollPageTo(-document.body.scrollHeight, \"top\"),\r\n      des: \"scroll to the top of the page\",\r\n      cat: \"Navigation\"\r\n    },\r\n    j: {\r\n      key: \"j\",\r\n      fun: () => highlightResult(\"down\")(),\r\n      des: \"select next search result\",\r\n      cat: \"Results\"\r\n    },\r\n    k: {\r\n      key: \"k\",\r\n      fun: () => highlightResult(\"up\")(),\r\n      des: \"select previous search result\",\r\n      cat: \"Results\"\r\n    },\r\n    u: {\r\n      key: \"u\",\r\n      fun: () => scrollPage(-window.innerHeight / 2),\r\n      des: \"scroll half a page up\",\r\n      cat: \"Navigation\"\r\n    },\r\n    v: {\r\n      key: \"v\",\r\n      fun: () => scrollPageTo(document.body.scrollHeight, \"bottom\"),\r\n      des: \"scroll to the bottom of the page\",\r\n      cat: \"Navigation\"\r\n    },\r\n    y: {\r\n      key: \"y\",\r\n      fun: () => copyURLToClipboard(),\r\n      des: \"copy url of the selected result to the clipboard\",\r\n      cat: \"Results\"\r\n    },\r\n    ...baseKeyBinding\r\n  }\r\n};\r\n\r\nconst keyBindings: Record<string, KeyBinding> =\r\n  settings.hotkeys && settings.hotkeys in keyBindingLayouts\r\n    ? keyBindingLayouts[settings.hotkeys]\r\n    : keyBindingLayouts.default;\r\n\r\nconst isElementInDetail = (element?: HTMLElement): boolean => {\r\n  const ancestor = element?.closest(\".detail, .result\");\r\n  return ancestor?.classList.contains(\"detail\") ?? false;\r\n};\r\n\r\nconst getResultElement = (element?: HTMLElement): HTMLElement | undefined => {\r\n  return element?.closest(\".result\") ?? undefined;\r\n};\r\n\r\nconst isImageResult = (resultElement?: HTMLElement): boolean => {\r\n  return resultElement?.classList.contains(\"result-images\") ?? false;\r\n};\r\n\r\nconst highlightResult =\r\n  (which: HighlightResultElement | HTMLElement) =>\r\n  (noScroll?: boolean, keepFocus?: boolean): void => {\r\n    let effectiveWhich = which;\r\n    let current = document.querySelector<HTMLElement>(\".result[data-vim-selected]\");\r\n    if (!current) {\r\n      // no selection : choose the first one\r\n      current = document.querySelector<HTMLElement>(\".result\");\r\n      if (!current) {\r\n        // no first one : there are no results\r\n        return;\r\n      }\r\n      // replace up/down actions by selecting first one\r\n      if (which === \"down\" || which === \"up\") {\r\n        effectiveWhich = current;\r\n      }\r\n    }\r\n\r\n    const results = Array.from(document.querySelectorAll<HTMLElement>(\".result\"));\r\n\r\n    let next: HTMLElement | undefined;\r\n\r\n    if (typeof effectiveWhich !== \"string\") {\r\n      next = effectiveWhich;\r\n    } else {\r\n      switch (effectiveWhich) {\r\n        case \"visible\": {\r\n          const top = document.documentElement.scrollTop || document.body.scrollTop;\r\n          const bot = top + document.documentElement.clientHeight;\r\n\r\n          for (const element of results) {\r\n            const etop = element.offsetTop;\r\n            const ebot = etop + element.clientHeight;\r\n            if (ebot <= bot && etop > top) {\r\n              next = element;\r\n              break;\r\n            }\r\n          }\r\n          break;\r\n        }\r\n        case \"down\":\r\n          next = results[results.indexOf(current) + 1] || current;\r\n          break;\r\n        case \"up\":\r\n          next = results[results.indexOf(current) - 1] || current;\r\n          break;\r\n        case \"bottom\":\r\n          next = results.at(-1);\r\n          break;\r\n        // biome-ignore lint/complexity/noUselessSwitchCase: fallthrough is intended\r\n        case \"top\":\r\n        default:\r\n          [next] = results;\r\n      }\r\n    }\r\n\r\n    if (next) {\r\n      current.removeAttribute(\"data-vim-selected\");\r\n      next.setAttribute(\"data-vim-selected\", \"true\");\r\n\r\n      if (!keepFocus) {\r\n        const link = next.querySelector<HTMLAnchorElement>(\"h3 a\") || next.querySelector<HTMLAnchorElement>(\"a\");\r\n        link?.focus();\r\n      }\r\n\r\n      if (!noScroll) {\r\n        mutable.scrollPageToSelected?.();\r\n      }\r\n    }\r\n  };\r\n\r\nconst reloadPage = (): void => {\r\n  document.location.reload();\r\n};\r\n\r\nconst removeFocus = (event: KeyboardEvent): void => {\r\n  const target = event.target as HTMLElement;\r\n  const tagName = target?.tagName?.toLowerCase();\r\n\r\n  if (document.activeElement && (tagName === \"input\" || tagName === \"select\" || tagName === \"textarea\")) {\r\n    (document.activeElement as HTMLElement).blur();\r\n  } else {\r\n    mutable.closeDetail?.();\r\n  }\r\n};\r\n\r\nconst pageButtonClick = (css_selector: string): void => {\r\n  const button = document.querySelector<HTMLButtonElement>(css_selector);\r\n  if (button) {\r\n    button.click();\r\n  }\r\n};\r\n\r\nconst GoToNextPage = (): void => {\r\n  pageButtonClick('nav#pagination .next_page button[type=\"submit\"]');\r\n};\r\n\r\nconst GoToPreviousPage = (): void => {\r\n  pageButtonClick('nav#pagination .previous_page button[type=\"submit\"]');\r\n};\r\n\r\nmutable.scrollPageToSelected = (): void => {\r\n  const sel = document.querySelector<HTMLElement>(\".result[data-vim-selected]\");\r\n  if (!sel) return;\r\n\r\n  const wtop = document.documentElement.scrollTop || document.body.scrollTop;\r\n  const height = document.documentElement.clientHeight;\r\n  const etop = sel.offsetTop;\r\n  const ebot = etop + sel.clientHeight;\r\n  const offset = 120;\r\n\r\n  // first element ?\r\n  if (!sel.previousElementSibling && ebot < height) {\r\n    // set to the top of page if the first element\r\n    // is fully included in the viewport\r\n    window.scroll(window.scrollX, 0);\r\n    return;\r\n  }\r\n\r\n  if (wtop > etop - offset) {\r\n    window.scroll(window.scrollX, etop - offset);\r\n  } else {\r\n    const wbot = wtop + height;\r\n    if (wbot < ebot + offset) {\r\n      window.scroll(window.scrollX, ebot - height + offset);\r\n    }\r\n  }\r\n};\r\n\r\nconst scrollPage = (amount: number): void => {\r\n  window.scrollBy(0, amount);\r\n  highlightResult(\"visible\")();\r\n};\r\n\r\nconst scrollPageTo = (position: number, nav: HighlightResultElement): void => {\r\n  window.scrollTo(0, position);\r\n  highlightResult(nav)();\r\n};\r\n\r\nconst searchInputFocus = (): void => {\r\n  window.scrollTo(0, 0);\r\n\r\n  const q = document.querySelector<HTMLInputElement>(\"#q\");\r\n  if (q) {\r\n    q.focus();\r\n\r\n    if (q.setSelectionRange) {\r\n      const len = q.value.length;\r\n\r\n      q.setSelectionRange(len, len);\r\n    }\r\n  }\r\n};\r\n\r\nconst openResult = (newTab: boolean): void => {\r\n  let link = document.querySelector<HTMLAnchorElement>(\".result[data-vim-selected] h3 a\");\r\n  if (!link) {\r\n    link = document.querySelector<HTMLAnchorElement>(\".result[data-vim-selected] > a\");\r\n  }\r\n  if (!link) return;\r\n\r\n  const url = link.getAttribute(\"href\");\r\n  if (url) {\r\n    if (newTab) {\r\n      window.open(url);\r\n    } else {\r\n      window.location.href = url;\r\n    }\r\n  }\r\n};\r\n\r\nconst initHelpContent = (divElement: HTMLElement, keyBindings: typeof baseKeyBinding): void => {\r\n  const categories: Record<string, KeyBinding[]> = {};\r\n\r\n  for (const binding of Object.values(keyBindings)) {\r\n    const { cat } = binding;\r\n    categories[cat] ??= [];\r\n    categories[cat].push(binding);\r\n  }\r\n\r\n  const sortedCategoryKeys = Object.keys(categories).sort(\r\n    (a, b) => (categories[b]?.length ?? 0) - (categories[a]?.length ?? 0)\r\n  );\r\n\r\n  let html = '<a href=\"#\" class=\"close\" aria-label=\"close\" title=\"close\">×</a>';\r\n  html += \"<h3>How to navigate SearXNG with hotkeys</h3>\";\r\n  html += \"<table>\";\r\n\r\n  for (const [i, categoryKey] of sortedCategoryKeys.entries()) {\r\n    const bindings = categories[categoryKey];\r\n    if (!bindings || bindings.length === 0) continue;\r\n\r\n    const isFirst = i % 2 === 0;\r\n    const isLast = i === sortedCategoryKeys.length - 1;\r\n\r\n    if (isFirst) {\r\n      html += \"<tr>\";\r\n    }\r\n\r\n    html += \"<td>\";\r\n    html += `<h4>${categoryKey}</h4>`;\r\n    html += '<ul class=\"list-unstyled\">';\r\n\r\n    for (const binding of bindings) {\r\n      html += `<li><kbd>${binding.key}</kbd> ${binding.des}</li>`;\r\n    }\r\n\r\n    html += \"</ul>\";\r\n    html += \"</td>\";\r\n\r\n    if (!isFirst || isLast) {\r\n      html += \"</tr>\";\r\n    }\r\n  }\r\n\r\n  html += \"</table>\";\r\n\r\n  divElement.innerHTML = html;\r\n};\r\n\r\nconst toggleHelp = (keyBindings: typeof baseKeyBinding): void => {\r\n  let helpPanel = document.querySelector<HTMLElement>(\"#vim-hotkeys-help\");\r\n  if (helpPanel) {\r\n    // toggle hidden\r\n    helpPanel.classList.toggle(\"invisible\");\r\n  } else {\r\n    // first call\r\n    helpPanel = Object.assign(document.createElement(\"div\"), {\r\n      id: \"vim-hotkeys-help\",\r\n      className: \"dialog-modal\"\r\n    });\r\n    initHelpContent(helpPanel, keyBindings);\r\n    const [body] = document.getElementsByTagName(\"body\");\r\n    if (body) {\r\n      body.appendChild(helpPanel);\r\n    }\r\n  }\r\n};\r\n\r\nconst copyURLToClipboard = async (): Promise<void> => {\r\n  const selectedResult = document.querySelector<HTMLElement>(\".result[data-vim-selected]\");\r\n  if (!selectedResult) return;\r\n\r\n  const resultAnchor = selectedResult.querySelector<HTMLAnchorElement>(\"a\");\r\n  assertElement(resultAnchor);\r\n\r\n  const url = resultAnchor.getAttribute(\"href\");\r\n  if (url) {\r\n    if (window.isSecureContext) {\r\n      await navigator.clipboard.writeText(url);\r\n    } else {\r\n      const selection = window.getSelection();\r\n      if (selection) {\r\n        const node = document.createElement(\"span\");\r\n        node.textContent = url;\r\n        resultAnchor.appendChild(node);\r\n\r\n        const range = document.createRange();\r\n        range.selectNodeContents(node);\r\n        selection.removeAllRanges();\r\n        selection.addRange(range);\r\n        document.execCommand(\"copy\");\r\n        node.remove();\r\n      }\r\n    }\r\n  }\r\n};\r\n\r\nlisten(\"click\", \".result\", function (this: HTMLElement, event: PointerEvent) {\r\n  if (!isElementInDetail(event.target as HTMLElement)) {\r\n    highlightResult(this)(true, true);\r\n\r\n    const resultElement = getResultElement(event.target as HTMLElement);\r\n\r\n    if (resultElement && isImageResult(resultElement)) {\r\n      event.preventDefault();\r\n      mutable.selectImage?.(resultElement);\r\n    }\r\n  }\r\n});\r\n\r\n// FIXME: Focus might also trigger Pointer event ^^^\r\nlisten(\r\n  \"focus\",\r\n  \".result a\",\r\n  (event: FocusEvent) => {\r\n    if (!isElementInDetail(event.target as HTMLElement)) {\r\n      const resultElement = getResultElement(event.target as HTMLElement);\r\n\r\n      if (resultElement && !resultElement.hasAttribute(\"data-vim-selected\")) {\r\n        highlightResult(resultElement)(true);\r\n      }\r\n\r\n      if (resultElement && isImageResult(resultElement)) {\r\n        event.preventDefault();\r\n        mutable.selectImage?.(resultElement);\r\n      }\r\n    }\r\n  },\r\n  { capture: true }\r\n);\r\n\r\nlisten(\"keydown\", document, (event: KeyboardEvent) => {\r\n  // check for modifiers so we don't break browser's hotkeys\r\n  if (Object.hasOwn(keyBindings, event.key) && !event.ctrlKey && !event.altKey && !event.shiftKey && !event.metaKey) {\r\n    const tagName = (event.target as HTMLElement)?.tagName?.toLowerCase();\r\n\r\n    if (event.key === \"Escape\") {\r\n      keyBindings[event.key]?.fun(event);\r\n    } else if (event.target === document.body || tagName === \"a\" || tagName === \"button\") {\r\n      event.preventDefault();\r\n      keyBindings[event.key]?.fun(event);\r\n    }\r\n  }\r\n});\r\n\r\nmutable.selectNext = highlightResult(\"down\");\r\nmutable.selectPrevious = highlightResult(\"up\");\r\n"],"mappings":"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"}