{"version":3,"file":"Q2W2fJLA.min.js","names":["searchForm: HTMLFormElement","searchInput: HTMLInputElement","searchReset: HTMLButtonElement","isMobile: boolean","isResultsPage: boolean","categoryButtons: HTMLButtonElement[]"],"sources":["../../../../../client/simple/src/js/main/search.ts"],"sourcesContent":["// SPDX-License-Identifier: AGPL-3.0-or-later\r\n\r\nimport { listen } from \"../toolkit.ts\";\r\nimport { getElement } from \"../util/getElement.ts\";\r\n\r\nconst searchForm: HTMLFormElement = getElement<HTMLFormElement>(\"search\");\r\nconst searchInput: HTMLInputElement = getElement<HTMLInputElement>(\"q\");\r\nconst searchReset: HTMLButtonElement = getElement<HTMLButtonElement>(\"clear_search\");\r\n\r\nconst isMobile: boolean = window.matchMedia(\"(max-width: 50em)\").matches;\r\nconst isResultsPage: boolean = document.querySelector(\"main\")?.id === \"main_results\";\r\n\r\nconst categoryButtons: HTMLButtonElement[] = Array.from(\r\n  document.querySelectorAll<HTMLButtonElement>(\"#categories_container button.category\")\r\n);\r\n\r\nif (searchInput.value.length === 0) {\r\n  searchReset.classList.add(\"empty\");\r\n}\r\n\r\n// focus search input on large screens\r\nif (!(isMobile || isResultsPage)) {\r\n  searchInput.focus();\r\n}\r\n\r\n// On mobile, move cursor to the end of the input on focus\r\nif (isMobile) {\r\n  listen(\"focus\", searchInput, () => {\r\n    // Defer cursor move until the next frame to prevent a visual jump\r\n    requestAnimationFrame(() => {\r\n      const end = searchInput.value.length;\r\n      searchInput.setSelectionRange(end, end);\r\n      searchInput.scrollLeft = searchInput.scrollWidth;\r\n    });\r\n  });\r\n}\r\n\r\nlisten(\"input\", searchInput, () => {\r\n  searchReset.classList.toggle(\"empty\", searchInput.value.length === 0);\r\n});\r\n\r\nlisten(\"click\", searchReset, (event: MouseEvent) => {\r\n  event.preventDefault();\r\n  searchInput.value = \"\";\r\n  searchInput.focus();\r\n  searchReset.classList.add(\"empty\");\r\n});\r\n\r\nfor (const button of categoryButtons) {\r\n  listen(\"click\", button, (event: MouseEvent) => {\r\n    if (event.shiftKey) {\r\n      event.preventDefault();\r\n      button.classList.toggle(\"selected\");\r\n      return;\r\n    }\r\n\r\n    // deselect all other categories\r\n    for (const categoryButton of categoryButtons) {\r\n      categoryButton.classList.toggle(\"selected\", categoryButton === button);\r\n    }\r\n  });\r\n}\r\n\r\nif (document.querySelector(\"div.search_filters\")) {\r\n  const safesearchElement = document.getElementById(\"safesearch\");\r\n  if (safesearchElement) {\r\n    listen(\"change\", safesearchElement, () => searchForm.submit());\r\n  }\r\n\r\n  const timeRangeElement = document.getElementById(\"time_range\");\r\n  if (timeRangeElement) {\r\n    listen(\"change\", timeRangeElement, () => searchForm.submit());\r\n  }\r\n\r\n  const languageElement = document.getElementById(\"language\");\r\n  if (languageElement) {\r\n    listen(\"change\", languageElement, () => searchForm.submit());\r\n  }\r\n}\r\n\r\n// override searchForm submit event\r\nlisten(\"submit\", searchForm, (event: Event) => {\r\n  event.preventDefault();\r\n\r\n  if (categoryButtons.length > 0) {\r\n    const searchCategories = getElement<HTMLInputElement>(\"selected-categories\");\r\n    searchCategories.value = categoryButtons\r\n      .filter((button) => button.classList.contains(\"selected\"))\r\n      .map((button) => button.name.replace(\"category_\", \"\"))\r\n      .join(\",\");\r\n  }\r\n\r\n  searchForm.submit();\r\n});\r\n"],"mappings":"yEAKA,IAAMA,EAA8B,EAA4B,SAAS,CACnEC,EAAgC,EAA6B,IAAI,CACjEC,EAAiC,EAA8B,eAAe,CAE9EC,EAAoB,OAAO,WAAW,oBAAoB,CAAC,QAC3DC,EAAyB,SAAS,cAAc,OAAO,EAAE,KAAO,eAEhEC,EAAuC,MAAM,KACjD,SAAS,iBAAoC,wCAAwC,CACtF,CAEG,EAAY,MAAM,SAAW,GAC/B,EAAY,UAAU,IAAI,QAAQ,CAI9B,GAAY,GAChB,EAAY,OAAO,CAIjB,GACF,EAAO,QAAS,MAAmB,CAEjC,0BAA4B,CAC1B,IAAM,EAAM,EAAY,MAAM,OAC9B,EAAY,kBAAkB,EAAK,EAAI,CACvC,EAAY,WAAa,EAAY,aACrC,EACF,CAGJ,EAAO,QAAS,MAAmB,CACjC,EAAY,UAAU,OAAO,QAAS,EAAY,MAAM,SAAW,EAAE,EACrE,CAEF,EAAO,QAAS,EAAc,GAAsB,CAClD,EAAM,gBAAgB,CACtB,EAAY,MAAQ,GACpB,EAAY,OAAO,CACnB,EAAY,UAAU,IAAI,QAAQ,EAClC,CAEF,IAAK,IAAM,KAAU,EACnB,EAAO,QAAS,EAAS,GAAsB,CAC7C,GAAI,EAAM,SAAU,CAClB,EAAM,gBAAgB,CACtB,EAAO,UAAU,OAAO,WAAW,CACnC,OAIF,IAAK,IAAM,KAAkB,EAC3B,EAAe,UAAU,OAAO,WAAY,IAAmB,EAAO,EAExE,CAGJ,GAAI,SAAS,cAAc,qBAAqB,CAAE,CAChD,IAAM,EAAoB,SAAS,eAAe,aAAa,CAC3D,GACF,EAAO,SAAU,MAAyB,EAAW,QAAQ,CAAC,CAGhE,IAAM,EAAmB,SAAS,eAAe,aAAa,CAC1D,GACF,EAAO,SAAU,MAAwB,EAAW,QAAQ,CAAC,CAG/D,IAAM,EAAkB,SAAS,eAAe,WAAW,CACvD,GACF,EAAO,SAAU,MAAuB,EAAW,QAAQ,CAAC,CAKhE,EAAO,SAAU,EAAa,GAAiB,CAG7C,GAFA,EAAM,gBAAgB,CAElB,EAAgB,OAAS,EAAG,CAC9B,IAAM,EAAmB,EAA6B,sBAAsB,CAC5E,EAAiB,MAAQ,EACtB,OAAQ,GAAW,EAAO,UAAU,SAAS,WAAW,CAAC,CACzD,IAAK,GAAW,EAAO,KAAK,QAAQ,YAAa,GAAG,CAAC,CACrD,KAAK,IAAI,CAGd,EAAW,QAAQ,EACnB"}